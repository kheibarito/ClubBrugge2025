![CI](https://github.com/kheibarito/ClubBrugge2025/actions/workflows/ci.yml/badge.svg)

## clubbrugge – optical‑tracking loaders & metrics

`clubbrugge` converts raw **Second Spectrum** JSON / JSONL into compressed Parquet and exposes three core performance metrics:

* total distance  
* distance split by speed bands  
* high‑speed‑acceleration counts  

The project follows modern Python packaging (PEP 621 metadata, PEP 660 editable installs) and ships an 8‑test pytest suite plus Ruff linting.

---

## Installation

### Wheel (stable build)

```bash
python -m pip install clubbrugge-0.1.0-py3-none-any.whl
```

### Editable dev install

```bash
git clone https://github.com/kheibarito/ClubBrugge2025.git
cd ClubBrugge2025
python -m pip install --editable '.[dev]'   # quotes required in zsh
```
*(PEP 660 lets you edit code without re‑installing.)*

---

## Data layout

```
project/
├── SourceFiles/          # raw input (ignored by git)
│   ├── metadata.json
│   └── tracking-produced.jsonl
├── data/                 # autogenerated Parquet (ignored by git)
│   ├── metadata.parquet
│   └── tracking.parquet
└── …
```

> Download the two raw files into **`SourceFiles/`** before running the loaders; they’re `.gitignore`‑d to keep the repository light.

The loader streams the JSONL line‑by‑line, explodes to one row per player‑frame and writes Parquet with PyArrow—columnar storage yields ~10× smaller files and faster scans than CSV.

---

## Quick‑start example

```python
from clubbrugge.io import load_metadata, load_tracking_data
from clubbrugge.metrics import (
    total_distance,
    distance_by_speed_band,
    count_high_speed_accel,
)

meta  = load_metadata("SourceFiles/metadata.json")
track = load_tracking_data("SourceFiles/tracking-produced.jsonl")

# 1 – total metres
dist = total_distance(track)

# 2 – distance per speed zone (m·s⁻¹ thresholds)
bands = [(0, 4), (4, 5.5), (5.5, 7), (7, float("inf"))]
dist_band = distance_by_speed_band(track, bands)

# 3 – explosive accelerations ≥3 m·s⁻² while moving ≥5.5 m·s⁻¹
accel = count_high_speed_accel(track, min_speed=5.5, min_accel=3.0)
```

Reload Parquet anytime:

```python
import pandas as pd
df = pd.read_parquet("data/tracking.parquet")   # pandas auto‑selects PyArrow
```

---

## Metric definitions

| Metric | Default thresholds | Formula | Scientific precedent |
| ------ | ------------------ | ------- | -------------------- |
| **Total distance** | — | Σ √(Δx² + Δy²) | Standard optical/GPS method |
| **Speed‑band distance** | 0–4, 4–5.5, 5.5–7, > 7 m·s⁻¹ | speed × Δt within band | Common soccer‑science speed zones |
| **High‑speed accel events** | speed ≥ 5.5 m·s⁻¹ & accel ≥ 3 m·s⁻² | rising‑edge counter | Varley & Aughey 2013 |

*(Second Spectrum records at 25 Hz, so Δt ≈ 0.04 s.)*

---

## Testing & linting

```bash
pytest -q          # 8 tests – all green
ruff check src/    # zero issues
```

CI runs the same two commands via **GitHub Actions**.

A Python 3.12 / tqdm UTC deprecation warning is suppressed for a clean log.

---

## Packaging highlights

* **PEP 621** declarative metadata in `pyproject.toml` – no `setup.py`.  
* **PEP 660** editable install (`pip install -e`).  
* Dev‑only tools (`pytest`, `ruff`) live in the `[project.optional-dependencies] dev` extra.  
* Build artefacts created with `python -m build` land in `dist/` and embed the MIT license.

---

## License

Released under the [MIT License](LICENSE).
